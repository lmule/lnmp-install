CREATE TABLE t1 (c1 DATE) ENGINE=InnoDB;
CREATE FUNCTION f2() RETURNS INT RETURN (SELECT data FROM t1 LIMIT 1);
XA START 0x7465737462, 0x2030405060, 0xb;
EXPLAIN SELECT * FROM t1 WHERE c1 = f2(RAND());
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	ALL	NULL	NULL	NULL	NULL	1	Using where
XA END 0x7465737462, 0x2030405060, 0xb;
XA PREPARE 0x7465737462, 0x2030405060, 0xb;
SELECT f2();
ERROR XAE07: XAER_RMFAIL: The command cannot be executed when global transaction is in the  PREPARED state
XA COMMIT 0x7465737462, 0x2030405060, 0xb;
DROP TABLE t1;
DROP FUNCTION f2;
